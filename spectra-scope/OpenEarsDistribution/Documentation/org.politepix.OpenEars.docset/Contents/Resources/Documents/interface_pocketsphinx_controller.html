<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenEars: PocketsphinxController Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenEars
   </div>
   <div id="projectbrief">A shared-source framework for speech recognition and text to speech</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('interface_pocketsphinx_controller.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="class_pocketsphinx_controller-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">PocketsphinxController Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The class that controls local speech recognition in OpenEars. </p>
<h2>Usage examples</h2>
<blockquote class="doxtable">
<p>Preparing to use the class:</p>
<p></p>
</blockquote>
<p>To use PocketsphinxController, you need a language model and a phonetic dictionary for it. These files define which words PocketsphinxController is capable of recognizing. They are created above by using LanguageModelGenerator. You also need an acoustic model. OpenEars ships with an English and a Spanish acoustic model.</p>
 <blockquote class="doxtable">
<p>What to add to your header:</p>
<p></p>
</blockquote>
Add the following lines to your header (the .h file). Under the imports at the very top:
<pre>
#import &lt;OpenEars/PocketsphinxController.h&gt;
#import &lt;OpenEars/AcousticModel.h&gt;
</pre>
In the middle part where instance variables go:
<pre>
PocketsphinxController *pocketsphinxController;
</pre>
In the bottom part where class properties go:
<pre>
@property (strong, nonatomic) PocketsphinxController *pocketsphinxController;
</pre>
 <blockquote class="doxtable">
<p>What to add to your implementation:</p>
<p></p>
</blockquote>
Add the following to your implementation (the .m file):

Under the @implementation keyword at the top:
<pre>
@synthesize pocketsphinxController;
</pre>

Among the other methods of the class, add this lazy accessor method for confident memory management of the object:

<pre>
- (PocketsphinxController *)pocketsphinxController {
	if (pocketsphinxController == nil) {
		pocketsphinxController = [[PocketsphinxController alloc] init];
	}
	return pocketsphinxController;
}
</pre>
 <blockquote class="doxtable">
<p>How to use the class methods:</p>
<p></p>
</blockquote>
In the method where you want to recognize speech (to test this out, add it to your viewDidLoad method), add the following method call:
<pre>
[self.pocketsphinxController startListeningWithLanguageModelAtPath:lmPath dictionaryAtPath:dicPath acousticModelAtPath:[AcousticModel pathToModel:@"AcousticModelEnglish"] languageModelIsJSGF:NO]; // Change "AcousticModelEnglish" to "AcousticModelSpanish" to perform Spanish recognition instead of English.

</pre>
 <dl class="section warning"><dt>Warning</dt><dd>There can only be one <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a> instance in your app. </dd></dl>
</div><h2 class="groupheader">Method Documentation</h2>
<a class="anchor" id="a5f2fb597c5b47fe2f8cb09d60601ff54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) startListeningWithLanguageModelAtPath: </td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>languageModelPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">dictionaryAtPath:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>dictionaryPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">acousticModelAtPath:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>acousticModelPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">languageModelIsJSGF:</td>
          <td></td>
          <td class="paramtype">(BOOL)&#160;</td>
          <td class="paramname"><em>languageModelIsJSGF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start the speech recognition engine up. You provide the full paths to a language model and a dictionary file which are created using <a class="el" href="interface_language_model_generator.html" title="The class that generates the vocabulary the PocketsphinxController is able to understand.">LanguageModelGenerator</a> and the acoustic model you want to use (for instance [<a class="el" href="interface_acoustic_model.html" title="Convenience class for accessing the acoustic model bundles. All this does is allow you to reference y...">AcousticModel</a> pathToModel:"AcousticModelEnglish"]). </p>

</div>
</div>
<a class="anchor" id="ab010e9f7f5f730ffb62eb38be19d0388"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) stopListening </td>
          <td></td>
          <td class="paramname"></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Shut down the engine. You must do this before releasing a parent view controller that contains <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a>. </p>

</div>
</div>
<a class="anchor" id="aeaa63998081a505eb2338ab816562892"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) suspendRecognition </td>
          <td></td>
          <td class="paramname"></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Keep the engine going but stop listening to speech until resumeRecognition is called. Takes effect instantly. </p>

</div>
</div>
<a class="anchor" id="a773129a910600f077a3c679ca3e9e5df"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) resumeRecognition </td>
          <td></td>
          <td class="paramname"></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Resume listening for speech after suspendRecognition has been called. </p>

</div>
</div>
<a class="anchor" id="adc692425dd239522865c3aa903a9c422"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) changeLanguageModelToFile: </td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>languageModelPathAsString</em></td>
        </tr>
        <tr>
          <td class="paramkey">withDictionary:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>dictionaryPathAsString</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Change from one language model to another. This lets you change which words you are listening for depending on the context in your app. If you have already started the recognition loop and you want to switch to a different language model, you can use this and the model will be changed at the earliest opportunity. Will not have any effect unless recognition is already in progress. It isn't possible to change acoustic models in the middle of an already-started listening loop, just language model and dictionary. </p>

</div>
</div>
<a class="anchor" id="ad573849f9caebd3ac39ddfbec9b944ad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (Float32) pocketsphinxInputLevel </td>
          <td></td>
          <td class="paramname"></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Gives the volume of the incoming speech. This is a UI hook. You can't read it on the main thread or it will block. </p>

</div>
</div>
<a class="anchor" id="ad7635d1e4287145c1c631b61c632db6f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">- (void) runRecognitionOnWavFileAtPath: </td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>wavPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">usingLanguageModelAtPath:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>languageModelPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">dictionaryAtPath:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>dictionaryPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">acousticModelAtPath:</td>
          <td></td>
          <td class="paramtype">(NSString *)&#160;</td>
          <td class="paramname"><em>acousticModelPath</em></td>
        </tr>
        <tr>
          <td class="paramkey">languageModelIsJSGF:</td>
          <td></td>
          <td class="paramtype">(BOOL)&#160;</td>
          <td class="paramname"><em>languageModelIsJSGF</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>You can use this to run recognition on an already-recorded WAV file for testing. The WAV file has to be 16-bit and 16000 samples per second. </p>

</div>
</div>
<h2 class="groupheader">Property Documentation</h2>
<a class="anchor" id="a4b041461b83ae9a95891e4df343288f5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (float) secondsOfSilenceToDetect</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This is how long <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a> should wait after speech ends to attempt to recognize speech. This defaults to .7 seconds. </p>

</div>
</div>
<a class="anchor" id="a441a879be770c054c14e9211b695cc83"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (BOOL) returnNbest</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Advanced: set this to TRUE to receive n-best results. </p>

</div>
</div>
<a class="anchor" id="a4acb3744552cd6278e71c3e26ab9e012"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (int) nBestNumber</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Advanced: the number of n-best results to return. This is a maximum number to return &ndash; if there are null hypotheses fewer than this number will be returned. </p>

</div>
</div>
<a class="anchor" id="a2f3a25d874a131b0d20c55901ecf71e6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (int) calibrationTime</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>How long to calibrate for. This can only be one of the values '1', '2', or '3'. Defaults to 1. </p>

</div>
</div>
<a class="anchor" id="a8be278e1f934200ca3ef2e259b5fe87c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (BOOL) verbosePocketSphinx</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Turn on verbose output. Do this any time you encounter an issue and any time you need to report an issue on the forums. </p>

</div>
</div>
<a class="anchor" id="af948a6a704dc338b2f0c21b6bf987b9f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (BOOL) returnNullHypotheses</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>By default, <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a> won't return a hypothesis if for some reason the hypothesis is null (this can happen if the perceived sound was just noise). If you need even empty hypotheses to be returned, you can set this to TRUE before starting <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a>. </p>

</div>
</div>
<a class="anchor" id="abeaddf4fc43d1b716846bd754ca57cb0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (NSString *) pathToTestFile</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">copy</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>By setting pathToTestFile to point to a recorded audio file you can run the main Pocketsphinx listening loop (not runRecognitionOnWavFileAtPath but the main loop invoked by using startListeningWithLanguageModelAtPath:) over a pre-recorded audio file instead of using it with live input. In contrast with using the method runRecognitionOnWavFileAtPath to receive a single recognition from a file, with this approach the audio file will have its buffers injected directly into the audio driver circular buffer for maximum fidelity to the goal of testing the entire codebase that is in use when doing a live recognition, including the whole driver, the calibration code, and the listening loop including all of its features. This is for creating tests for yourself and for sharing automatically replicable issue reports with Politepix. To use this, make an audio recording on the same device (i.e., if you are testing <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a> on an iPhone 5 with the internal microphone, make a recording on an iPhone 5 with the internal microphone, for instance using Apple's Voice Memos app) and then convert the resulting file to a 16-bit, 16000 sample rate, mono WAV file. You can do this with the output of Apple's Voice Memos app by taking the .m4a file that Voice Memos outputs and run it through this command in Terminal.app: "afconvert -f WAVE -d LEI16@16000 -c 1 ~/Desktop/Memo.m4a ~/Desktop/Memo.wav" Then add the WAV file to your app, and right before sending the call to startListeningWithLanguageModelAtPath, set this property pathToTestFile to the path to your audio file in your app as an NSString (e.g. [[NSBundle mainBundle] pathForResource:"Memo" ofType:@"wav"]). Note: when you record the audio file you will be using to test with, <b>always</b> make sure to have 5 seconds of silence at the beginning so there is enough time for calibration to be performed on your recording environment, since calibration is also part of the test. SmartCMN is disabled during testing so that the test gets the same results when run for different people. Please keep in mind that there are some settings in Pocketsphinx which may prevent a deterministic outcome from a recognition, meaning that you should expect a <b>similar</b> score over multiple runs of a test but you may not always see the <b>identical</b> score. For this reason and the fact that <a class="el" href="interface_pocketsphinx_controller.html" title="The class that controls local speech recognition in OpenEars.">PocketsphinxController</a> is asynchronous and results in real practice are delivered via uncoupled callback it has not been designed as a purely automated test, but as an observed practical test. If it were designed as a purely automated test it would be testing something other than the way PocketsphinxController/OpenEarsEventsObserver works in an app, which is designed for good speech implementations rather than tests. </p>

</div>
</div>
<a class="anchor" id="ad67f3122b7ad297e03be888c5a204023"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (BOOL) audioSessionMixing</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">assign</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Set this to true in order to allow audio session mixing </p>

</div>
</div>
<a class="anchor" id="a1e45e3aba2b0116c66ea8012ffec02dd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">- (NSString *) audioMode</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">read</span><span class="mlabel">write</span><span class="mlabel">nonatomic</span><span class="mlabel">copy</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>If you are using 5.0 or greater, you can set audio modes for the audio session manager to use. This can be set to the following:</p>
<p>"Default" to use kAudioSessionMode_Default = ‘dflt’,
@"VoiceChat" to use kAudioSessionMode_VoiceChat = ‘vcct’,
@"VideoRecording" kAudioSessionMode_VideoRecording = ‘vrcd’,
@"Measurement" kAudioSessionMode_Measurement = ‘msmt’</p>
<p>If you don't set it to anything, default will automatically be used. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="interface_pocketsphinx_controller.html">PocketsphinxController</a></li>
    <li class="footer">Generated on Tue Sep 10 2013 18:17:16 for OpenEars by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
